---
title: "lego"
author: "Darren Redmond"
date: "August 15th, 2018"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{lego}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r setup, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
require(lego)
```

Darren's lego package provides helper functions, shiny app, plots/graphs, and statistics for a Brickset exported lego csv file.

So you have created a brickset account and have added all of the lego sets that you own to your Brickset account. What next?

Well if you download your csv file for either your Owned or Wanted you can use this package to generate summary statistics, interactive plots, provide regression analysis, top 5 sets by value, and even comes with a shiny interactive application that you can analyse your lego collection in an interactive intuitive manner.

## Loading Data

So to export your data from Brickset - goto [https://brickset.com/export](https://brickset.com/export) and choose the exported csv file that you would like to export. The owned sets are the ones I started with:

[https://brickset.com/export/mysets/owned/csv](https://brickset.com/export/mysets/owned/csv)

For ease of use I've shipped the csv files from my account in the extdata directory as -> brickset-mysets-owned.csv
and brickset-mysets-wanted.csv
or all lego sets in the file sets.csv

These can be loaded with the code `system.file('extdata', 'brickset-mysets-owned.csv', package ='lego')`

I also a read.lego function which be used to convert the csv file into a dataset which the functions can use:

`read.lego(system.file('extdata', 'brickset-mysets-owned.csv', package ='lego')`
`head(data, 10)`

```{r, echo=FALSE, results='asis'}
data <- read.lego(system.file('extdata', 'brickset-mysets-owned.csv', package ='lego'))
knitr::kable(head(data))
```

So it can be seen that we have loaded in a dataset with 7 columns, theme, name, setId, year, pieces, price, subthem.

## Filtering Data

The first function created is the function to filter by year. This can be used to filter sets between a year range.

`filterByYear(data, 2004, 2011)`

```{r, echo=FALSE, results='asis'}
knitr::kable(head(filterByYear(data, 2004, 2011)))
```

The year parameters are defaulted to the min and max in the dataset so you might call this function with just a min year set:

`filterByYear(data, 2015)`

```{r, echo=FALSE, results='asis'}
knitr::kable(head(filterByYear(data, 2015)))
```

Or, with just a max year set:

`filterByYear(data, maxYear=2011)`

```{r, echo=FALSE, results='asis'}
knitr::kable(head(filterByYear(data, maxYear=2011)))
```

Then one might want to filter by more fields than just year - the price, the number of pieces, the themes, and the subthemes.
The `filterByYearPricePieceTheme(data, minYear, maxYear, minPrice, maxPrice, minPieces, maxPieces, themes, subthemes)` is the function for you.

`filterByYearPricePieceTheme(data, 2010, 2016, 5, 10, 100, 1000, c('Star Wars'), c('Episode I'))`

```{r, echo=FALSE, results='asis'}
knitr::kable(head(filterByYearPricePieceTheme(data, 2010, 2016, 5, 100, 100, 1000, c('Star Wars'), c('Episode I'))))
```

As you can see all Star Wars - Episode I sets between 2010 and 2016 inclusive, costing between 5 and 100 euros (also dollars - due to lego pricing policy), containing between 100 and 1000 pieces have been returned.

Or if you just wanted all of the Star Wars lego sets then the following can be called:

`filterByYearPricePieceTheme(data, themes=c('Star Wars'))`

```{r, echo=FALSE, results='asis'}
knitr::kable(head(filterByYearPricePieceTheme(data, themes=c('Star Wars'))))
```

This function is used extensively in the shiny application developed in this package.

## Grouping Data

Next I started to think of summary statistics and grouping the data by various fields so some helper groupBy functions were created.

To see the number of sets in each year in the dataset the following can be run:

`groupByYear(data)`

```{r, echo=FALSE, results='asis'}
knitr::kable(head(groupByYear(data), 15))
```

To see the number of pieces in each year in the dataset the following can be run:

`groupByPiece(data)`

```{r, echo=FALSE, results='asis'}
knitr::kable(head(groupByPiece(data), 15))
```

To see the price for each year in the dataset the following can be run:

`groupByPrice(data)`

```{r, echo=FALSE, results='asis'}
knitr::kable(head(groupByPrice(data), 15))
```

To see the number of themes for each year in the dataset the following can be run:

`groupByTheme(data)`

```{r, echo=FALSE, results='asis'}
knitr::kable(head(groupByTheme(data), 15))
```

To see the average number of pieces for each themes in the dataset the following can be run:

`groupByPieceThemeAvg(data)`

```{r, echo=FALSE, results='asis'}
knitr::kable(head(groupByPieceThemeAvg(data), 15))
```

## Plots

All of the helper functions above are useful for shaping the data to plot the data - so to see some ggplots the following functions were created.

```{r, fig.show='hold', echo=TRUE}
ggplotSetsCountByYear(groupByYear(data))
```

```{r, fig.show='hold', echo=TRUE}
ggplotPiecesCountByYear(groupByPiece(data))
```

```{r, fig.show='hold', echo=TRUE}
ggplotPriceByYear(groupByPrice(data))
```

```{r, fig.show='hold', echo=TRUE}
ggplotThemesCountByYear(groupByTheme(data))
```

```{r, fig.show='hold', echo=TRUE}
ggplotPieceByTheme(groupByPieceThemeAvg(data))
```

## Shiny Lego

To run the shiny lego application you may run the following code: `runShinyLego()`

Note: The shiny app here will only display in the browser and not in the R-Studio Preview of the Vignette.

```{r}
knitr::include_url("https://darrenredmond.shinyapps.io/shiny/")
```

## Help

[Vignette Home](index.html)

[Help Home](../html/00Index.html)

## More Examples

You can check out the examples for each of the functions here.

`example(filterByYear)`
